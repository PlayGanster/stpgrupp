export const CITY_CASES = {
  barnaul: {
    nominative: 'Барнаул',
    genitive: 'Барнаула',
    dative: 'Барнауле',       // исправлено с "Барнаулу" на "Барнауле"
    accusative: 'Барнаул',
    instrumental: 'Барнаулом',
    prepositional: 'о Барнауле',
    domain: 'barnaul',
  },
  arhangelsk: {
    nominative: 'Архангельск',
    genitive: 'Архангельска',
    dative: 'Архангельске',   // исправлено с "Архангельску" на "Архангельске"
    accusative: 'Архангельск',
    instrumental: 'Архангельском',
    prepositional: 'об Архангельске',
    domain: 'arhangelsk',
  },
  astrahan: {
    nominative: 'Астрахань',
    genitive: 'Астрахани',
    dative: 'Астрахани',      // корректно
    accusative: 'Астрахань',
    instrumental: 'Астраханью',
    prepositional: 'об Астрахани',
    domain: 'astrahan',
  },
  ufa: {
    nominative: 'Уфа',
    genitive: 'Уфы',
    dative: 'Уфе',            // корректно
    accusative: 'Уфу',
    instrumental: 'Уфой',
    prepositional: 'об Уфе',
    domain: 'ufa',
  },
  shatura: {
    nominative: 'Шатура',
    genitive: 'Шатуры',
    dative: 'Шатуре',
    accusative: 'Шатуру',
    instrumental: 'Шатурой',
    prepositional: 'о Шатуре',
    domain: 'shatura',
  },
  belgorod: {
    nominative: 'Белгород',
    genitive: 'Белгорода',
    dative: 'Белгороде',      // исправлено с "Белгороду" на "Белгороде"
    accusative: 'Белгород',
    instrumental: 'Белгородом',
    prepositional: 'о Белгороде',
    domain: 'belgorod',
  },
  bryansk: {
    nominative: 'Брянск',
    genitive: 'Брянска',
    dative: 'Брянске',        // исправлено с "Брянску" на "Брянске"
    accusative: 'Брянск',
    instrumental: 'Брянском',
    prepositional: 'о Брянске',
    domain: 'bryansk',
  },
  vladimir: {
    nominative: 'Владимир',
    genitive: 'Владимира',
    dative: 'Владимире',      // исправлено с "Владимиру" на "Владимире"
    accusative: 'Владимир',
    instrumental: 'Владимиром',
    prepositional: 'о Владимире',
    domain: 'vladimir',
  },
  volgograd: {
    nominative: 'Волгоград',
    genitive: 'Волгограда',
    dative: 'Волгограде',     // исправлено с "Волгограду" на "Волгограде"
    accusative: 'Волгоград',
    instrumental: 'Волгоградом',
    prepositional: 'о Волгограде',
    domain: 'volgograd',
  },
  vologda: {
    nominative: 'Вологда',
    genitive: 'Вологды',
    dative: 'Вологде',        // корректно
    accusative: 'Вологду',
    instrumental: 'Вологдой',
    prepositional: 'о Вологде',
    domain: 'vologda',
  },
  voronezh: {
    nominative: 'Воронеж',
    genitive: 'Воронежа',
    dative: 'Воронеже',       // исправлено с "Воронежу" на "Воронеже"
    accusative: 'Воронеж',
    instrumental: 'Воронежем',
    prepositional: 'о Воронеже',
    domain: 'voronezh',
  },
  ivanovo: {
    nominative: 'Иваново',
    genitive: 'Иванова',
    dative: 'Иванове',        // исправлено с "Иванову" на "Иванове"
    accusative: 'Иваново',
    instrumental: 'Ивановом',
    prepositional: 'об Иванове',
    domain: 'ivanovo',
  },
  kaluga: {
    nominative: 'Калуга',
    genitive: 'Калуги',
    dative: 'Калуге',         // корректно
    accusative: 'Калугу',
    instrumental: 'Калугой',
    prepositional: 'о Калуге',
    domain: 'kaluga',
  },
  kemerovo: {
    nominative: 'Кемерово',
    genitive: 'Кемерова',
    dative: 'Кемерове',       // исправлено с "Кемерову" на "Кемерове"
    accusative: 'Кемерово',
    instrumental: 'Кемеровом',
    prepositional: 'о Кемерове',
    domain: 'kemerovo',
  },
  kirov: {
    nominative: 'Киров',
    genitive: 'Кирова',
    dative: 'Кирове',         // исправлено с "Кирову" на "Кирове"
    accusative: 'Киров',
    instrumental: 'Кировом',
    prepositional: 'о Кирове',
    domain: 'kirov',
  },
  syktyvkar: {
    nominative: 'Сыктывкар',
    genitive: 'Сыктывкара',
    dative: 'Сыктывкаре',     // исправлено с "Сыктывкару" на "Сыктывкаре"
    accusative: 'Сыктывкар',
    instrumental: 'Сыктывкаром',
    prepositional: 'о Сыктывкаре',
    domain: 'syktyvkar',
  },
  kostroma: {
    nominative: 'Кострома',
    genitive: 'Костромы',
    dative: 'Костроме',       // корректно
    accusative: 'Кострому',
    instrumental: 'Костромой',
    prepositional: 'о Костроме',
    domain: 'kostroma',
  },
  novorossiysk: {
    nominative: 'Новороссийск',
    genitive: 'Новороссийска',
    dative: 'Новороссийске',  // исправлено с "Новороссийску" на "Новороссийске"
    accusative: 'Новороссийск',
    instrumental: 'Новороссийском',
    prepositional: 'о Новороссийске',
    domain: 'novorossiysk',
  },
  krasnoyarsk: {
    nominative: 'Красноярск',
    genitive: 'Красноярска',
    dative: 'Красноярске',    // исправлено с "Красноярску" на "Красноярске"
    accusative: 'Красноярск',
    instrumental: 'Красноярском',
    prepositional: 'о Красноярске',
    domain: 'krasnoyarsk',
  },
  kurgan: {
    nominative: 'Курган',
    genitive: 'Кургана',
    dative: 'Кургане',        // исправлено с "Кургану" на "Кургане"
    accusative: 'Курган',
    instrumental: 'Курганом',
    prepositional: 'о Кургане',
    domain: 'kurgan',
  },
  kursk: {
    nominative: 'Курск',
    genitive: 'Курска',
    dative: 'Курске',         // исправлено с "Курску" на "Курске"
    accusative: 'Курск',
    instrumental: 'Курском',
    prepositional: 'о Курске',
    domain: 'kursk',
  },
  lipeck: {
    nominative: 'Липецк',
    genitive: 'Липецка',
    dative: 'Липецке',        // исправлено с "Липецку" на "Липецке"
    accusative: 'Липецк',
    instrumental: 'Липецком',
    prepositional: 'о Липецке',
    domain: 'lipeck',
  },
  'joshkar-ola': {
    nominative: 'Йошкар-Ола',
    genitive: 'Йошкар-Олы',
    dative: 'Йошкар-Оле',     // корректно
    accusative: 'Йошкар-Олу',
    instrumental: 'Йошкар-Олой',
    prepositional: 'о Йошкар-Оле',
    domain: 'joshkar-ola',
  },
  saransk: {
    nominative: 'Саранск',
    genitive: 'Саранска',
    dative: 'Саранске',       // исправлено с "Саранску" на "Саранске"
    accusative: 'Саранск',
    instrumental: 'Саранском',
    prepositional: 'о Саранске',
    domain: 'saransk',
  },
  murmansk: {
    nominative: 'Мурманск',
    genitive: 'Мурманска',
    dative: 'Мурманске',      // исправлено с "Мурманску" на "Мурманске"
    accusative: 'Мурманск',
    instrumental: 'Мурманском',
    prepositional: 'о Мурманске',
    domain: 'murmansk',
  },
  'n-novgorod': {
    nominative: 'Нижний Новгород',
    genitive: 'Нижнего Новгорода',
    dative: 'Нижнем Новгороде', // исправлено с "Нижнему Новгороду" на "Нижнем Новгороде"
    accusative: 'Нижний Новгород',
    instrumental: 'Нижним Новгородом',
    prepositional: 'о Нижнем Новгороде',
    domain: 'n-novgorod',
  },
  novosibirsk: {
    nominative: 'Новосибирск',
    genitive: 'Новосибирска',
    dative: 'Новосибирске',   // исправлено с "Новосибирску" на "Новосибирске"
    accusative: 'Новосибирск',
    instrumental: 'Новосибирском',
    prepositional: 'о Новосибирске',
    domain: 'novosibirsk',
  },
  omsk: {
    nominative: 'Омск',
    genitive: 'Омска',
    dative: 'Омске',          // исправлено с "Омску" на "Омске"
    accusative: 'Омск',
    instrumental: 'Омском',
    prepositional: 'об Омске',
    domain: 'omsk',
  },
  orenburg: {
    nominative: 'Оренбург',
    genitive: 'Оренбурга',
    dative: 'Оренбурге',      // исправлено с "Оренбургу" на "Оренбурге"
    accusative: 'Оренбург',
    instrumental: 'Оренбургом',
    prepositional: 'об Оренбурге',
    domain: 'orenburg',
  },
  orel: {
    nominative: 'Орёл',
    genitive: 'Орла',
    dative: 'Орле',           // исправлено с "Орлу" на "Орле"
    accusative: 'Орла',
    instrumental: 'Орлом',
    prepositional: 'об Орле',
    domain: 'orel',
  },
  penza: {
    nominative: 'Пенза',
    genitive: 'Пензы',
    dative: 'Пензе',          // корректно
    accusative: 'Пензу',
    instrumental: 'Пензой',
    prepositional: 'о Пензе',
    domain: 'penza',
  },
  perm: {
    nominative: 'Пермь',
    genitive: 'Перми',
    dative: 'Перми',          // корректно
    accusative: 'Пермь',
    instrumental: 'Пермью',
    prepositional: 'о Перми',
    domain: 'perm',
  },
  'rostov-na-donu': {
    nominative: 'Ростов-на-Дону',
    genitive: 'Ростова-на-Дону',
    dative: 'Ростове-на-Дону', // исправлено с "Ростову-на-Дону" на "Ростове-на-Дону"
    accusative: 'Ростов-на-Дону',
    instrumental: 'Ростовом-на-Дону',
    prepositional: 'о Ростове-на-Дону',
    domain: 'rostov-na-donu',
  },
  taganrog: {
    nominative: 'Таганрог',
    genitive: 'Таганрога',
    dative: 'Таганроге',      // исправлено с "Таганрогу" на "Таганроге"
    accusative: 'Таганрог',
    instrumental: 'Таганрогом',
    prepositional: 'о Таганроге',
    domain: 'taganrog',
  },
  ryazan: {
    nominative: 'Рязань',
    genitive: 'Рязани',
    dative: 'Рязани',         // корректно
    accusative: 'Рязань',
    instrumental: 'Рязанью',
    prepositional: 'о Рязани',
    domain: 'ryazan',
  },
  samara: {
    nominative: 'Самара',
    genitive: 'Самары',
    dative: 'Самаре',         // корректно
    accusative: 'Самару',
    instrumental: 'Самарой',
    prepositional: 'о Самаре',
    domain: 'samara',
  },
  tolyatti: {
    nominative: 'Тольятти',
    genitive: 'Тольятти',
    dative: 'Тольятти',       // корректно
    accusative: 'Тольятти',
    instrumental: 'Тольятти',
    prepositional: 'о Тольятти',
    domain: 'tolyatti',
  },
  saratov: {
    nominative: 'Саратов',
    genitive: 'Саратова',
    dative: 'Саратове',       // исправлено с "Саратову" на "Саратове"
    accusative: 'Саратов',
    instrumental: 'Саратовом',
    prepositional: 'о Саратове',
    domain: 'saratov',
  },
  'nizhniy-tagil': {
    nominative: 'Нижний Тагил',
    genitive: 'Нижнего Тагила',
    dative: 'Нижнем Тагиле',  // исправлено с "Нижнему Тагилу" на "Нижнем Тагиле"
    accusative: 'Нижний Тагил',
    instrumental: 'Нижним Тагилом',
    prepositional: 'о Нижнем Тагиле',
    domain: 'nizhniy-tagil',
  },
  tambov: {
    nominative: 'Тамбов',
    genitive: 'Тамбова',
    dative: 'Тамбове',        // исправлено с "Тамбову" на "Тамбове"
    accusative: 'Тамбов',
    instrumental: 'Тамбовом',
    prepositional: 'о Тамбове',
    domain: 'tambov',
  },
  'naberezhnye-chelny': {
    nominative: 'Набережные Челны',
    genitive: 'Набережных Челнов',
    dative: 'Набережных Челнах', // исправлено с "Набережным Челнам" на "Набережных Челнах"
    accusative: 'Набережные Челны',
    instrumental: 'Набережными Челнами',
    prepositional: 'о Набережных Челнах',
    domain: 'naberezhnye-chelny',
  },
  tver: {
    nominative: 'Тверь',
    genitive: 'Твери',
    dative: 'Твери',          // корректно
    accusative: 'Тверь',
    instrumental: 'Тверью',
    prepositional: 'о Твери',
    domain: 'tver',
  },
  tomsk: {
    nominative: 'Томск',
    genitive: 'Томска',
    dative: 'Томске',         // исправлено с "Томску" на "Томске"
    accusative: 'Томск',
    instrumental: 'Томском',
    prepositional: 'о Томске',
    domain: 'tomsk',
  },
  tula: {
    nominative: 'Тула',
    genitive: 'Тулы',
    dative: 'Туле',           // корректно
    accusative: 'Тулу',
    instrumental: 'Тулой',
    prepositional: 'о Туле',
    domain: 'tula',
  },
  tyumen: {
    nominative: 'Тюмень',
    genitive: 'Тюмени',
    dative: 'Тюмени',         // корректно
    accusative: 'Тюмень',
    instrumental: 'Тюменью',
    prepositional: 'о Тюмени',
    domain: 'tyumen',
  },
  tobolsk: {
    nominative: 'Тобольск',
    genitive: 'Тобольска',
    dative: 'Тобольске',      // исправлено с "Тобольску" на "Тобольске"
    accusative: 'Тобольск',
    instrumental: 'Тобольском',
    prepositional: 'о Тобольске',
    domain: 'tobolsk',
  },
    izhevsk: {
    nominative: 'Ижевск',
    genitive: 'Ижевска',
    dative: 'Ижевске',       // исправлено с "Ижевску" на "Ижевске"
    accusative: 'Ижевск',
    instrumental: 'Ижевском',
    prepositional: 'об Ижевске',
    domain: 'izhevsk',
  },
  ulyanovsk: {
    nominative: 'Ульяновск',
    genitive: 'Ульяновска',
    dative: 'Ульяновске',    // исправлено с "Ульяновску" на "Ульяновске"
    accusative: 'Ульяновск',
    instrumental: 'Ульяновском',
    prepositional: 'об Ульяновске',
    domain: 'ulyanovsk',
  },
  cheboksary: {
    nominative: 'Чебоксары',
    genitive: 'Чебоксар',
    dative: 'Чебоксарах',    // исправлено с "Чебоксарам" на "Чебоксарах"
    accusative: 'Чебоксары',
    instrumental: 'Чебоксарами',
    prepositional: 'о Чебоксарах',
    domain: 'cheboksary',
  },
  'noviy-urengoy': {
    nominative: 'Новый Уренгой',
    genitive: 'Нового Уренгоя',
    dative: 'Новом Уренгое', // исправлено с "Новому Уренгою" на "Новом Уренгое"
    accusative: 'Новый Уренгой',
    instrumental: 'Новым Уренгоем',
    prepositional: 'о Новом Уренгое',
    domain: 'noviy-urengoy',
  },
  surgut: {
    nominative: 'Сургут',
    genitive: 'Сургута',
    dative: 'Сургуте',       // исправлено с "Сургуту" на "Сургуте"
    accusative: 'Сургут',
    instrumental: 'Сургутом',
    prepositional: 'о Сургуте',
    domain: 'surgut',
  },
  chelyabinsk: {
    nominative: 'Челябинск',
    genitive: 'Челябинска',
    dative: 'Челябинске',    // исправлено с "Челябинску" на "Челябинске"
    accusative: 'Челябинск',
    instrumental: 'Челябинском',
    prepositional: 'о Челябинске',
    domain: 'chelyabinsk',
  },
  magnitogorsk: {
    nominative: 'Магнитогорск',
    genitive: 'Магнитогорска',
    dative: 'Магнитогорске', // исправлено с "Магнитогорску" на "Магнитогорске"
    accusative: 'Магнитогорск',
    instrumental: 'Магнитогорском',
    prepositional: 'о Магнитогорске',
    domain: 'magnitogorsk',
  },
  ekaterinburg: {
    nominative: 'Екатеринбург',
    genitive: 'Екатеринбурга',
    dative: 'Екатеринбурге', // исправлено с "Екатеринбургу" на "Екатеринбурге"
    accusative: 'Екатеринбург',
    instrumental: 'Екатеринбургом',
    prepositional: 'о Екатеринбурге',
    domain: 'ekaterinburg',
  },
  kazan: {
    nominative: 'Казань',
    genitive: 'Казани',
    dative: 'Казани',        // корректно
    accusative: 'Казань',
    instrumental: 'Казанью',
    prepositional: 'о Казани',
    domain: 'kazan',
  },
  yaroslavl: {
    nominative: 'Ярославль',
    genitive: 'Ярославля',
    dative: 'Ярославле',     // исправлено с "Ярославлю" на "Ярославле"
    accusative: 'Ярославль',
    instrumental: 'Ярославлем',
    prepositional: 'о Ярославле',
    domain: 'yaroslavl',
  },
  vsia_rossia: {
    nominative: 'Вся Россия',
    genitive: 'Всей России',
    dative: 'Всей России',   // корректно
    accusative: 'Всю Россию',
    instrumental: 'Всей Россией',
    prepositional: 'о всей России',
    domain: '',
  }
} as const;


export type CitySlug = keyof typeof CITY_CASES;
export type CityCase = keyof typeof CITY_CASES[keyof typeof CITY_CASES];

export const DEFAULT_CITY: CitySlug = 'vsia_rossia';
export const ALL_CITIES = Object.keys(CITY_CASES) as CitySlug[];

export function isSupportedCity(city: string): city is CitySlug {
  return ALL_CITIES.includes(city as CitySlug);
}

export function detectCity(request: Request): CitySlug {
  // По заголовкам (если из middleware)
  const host = request.headers.get('host') || '';
  const cityFromDomain = detectCityFromDomain(host);
  
  if (cityFromDomain) return cityFromDomain;

  // По IP (упрощенная версия)
  const ip = request.headers.get('x-forwarded-for') || 
             request.headers.get('x-real-ip');
  
  if (ip) {
    // Здесь можно интегрировать с API геолокации
    const cityFromIP = detectCityFromIP(ip);
    if (cityFromIP) return cityFromIP;
  }

  return DEFAULT_CITY;
}

function detectCityFromDomain(host: string): CitySlug | null {
  const domain = host.split(':')[0];
  
  for (const [slug, data] of Object.entries(CITY_CASES)) {
    if (domain.includes(data.domain) || domain.includes(slug)) {
      return slug as CitySlug;
    }
  }
  
  return null;
}

function detectCityFromIP(ip: string): CitySlug | null {
  // Заглушка - здесь нужно интегрировать с API типа IPAPI, MaxMind и т.д.
  // Для примера просто возвращаем дефолтный город
  return DEFAULT_CITY;
}